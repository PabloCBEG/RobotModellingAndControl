% -------------------------------------------------
% APARTADO B1 - Modelo dinámico inverso
% -------------------------------------------------

function [qdd] = ModeloDinamico_R3GDL(in)
% Variables de entrada en la funcion: [q(3)  qp(3)  Tau(3)]
q1        = in(1);
q2        = in(2);
q3        = in(3);
qd1       = in(4);
qd2       = in(5);
qd3       = in(6);
Tau1      = in(7);
Tau2      = in(8);
Tau3      = in(9);

% A rellenar por el alumno

% Matriz de inercias
Ma =    [65.596*q3 + 32.798*cos(2.0*q2) - 65.596*sin(2.0*q2) - 65.596*q3*cos(2.0*q2) - 98.395*q3*sin(2.0*q2) - 49.197*q3^2*cos(2.0*q2) + 49.197*q3^2 + 147.49, 40.998*cos(q2) + 73.796*sin(q2) + 57.397*q3*cos(q2), 57.397*sin(q2);
                                                                                              2.7332*cos(q2) + 73.796*sin(q2) + 57.397*cos(q2)*(q3 + 0.66667),                    98.395*q3^2 + 131.19*q3 + 178.32,         98.395;
                                                                                                                                               57.397*sin(q2),                                              98.395,         99.657];

% Matriz de aceleraciones centrípetas y de Coriolis
Va = [(19901*qd1)/62500 + (23386898876037613301828182951575*qd2^2*cos(q2))/316912650057057350374175801344 - (29257007518544065132839043397630970041008754093*qd2^2*sin(q2))/713623846352979940529142984724747568191373312 + (2598543999581295917430234203809*qd1*qd3)/39614081257132168796771975168 + (18189808713670672203491716712087*qd2*qd3*cos(q2))/158456325028528675187087900672 - (2598543999581295917430234203809*qd1*qd2*cos(2*q2))/19807040628566084398385987584 - (2598543999581295917430234203809*qd1*qd3*cos(2*q2))/39614081257132168796771975168 - (18189808713670672203491716712087*q3*qd2^2*sin(q2))/316912650057057350374175801344 - (5851400792890314986562503942797795317859887813*qd1*qd2*sin(2*q2))/89202980794122492566142873090593446023921664 - (1730977868184499*qd1*qd3*sin(2*q2))/17592186044416 + (1730977868184499*q3*qd1*qd3)/17592186044416 + (1730977868184499*q3^2*qd1*qd2*sin(2*q2))/17592186044416 - (1730977868184499*q3*qd1*qd2*cos(2*q2))/8796093022208 - (1730977868184499*q3*qd1*qd3*cos(2*q2))/17592186044416 + (2598543999581295917430234203809*q3*qd1*qd2*sin(2*q2))/19807040628566084398385987584;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      (5306663498524693*qd2)/36028797018963968 + (2598543999581295917430234203809*qd2*qd3)/19807040628566084398385987584 + (2598543999581295917430234203809*qd1^2*cos(2*q2))/39614081257132168796771975168 + (5851400792890314986562503942797795317859887813*qd1^2*sin(2*q2))/178405961588244985132285746181186892047843328 - (1730977868184499*q3^2*qd1^2*sin(2*q2))/35184372088832 + (1730977868184499*q3*qd2*qd3)/8796093022208 + (1730977868184499*q3*qd1^2*cos(2*q2))/17592186044416 - (2598543999581295917430234203809*q3*qd1^2*sin(2*q2))/39614081257132168796771975168;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               (1951225971674839*qd3)/18014398509481984 + (2598543999581295917430234203809*qd1^2*cos(q2)^2)/39614081257132168796771975168 + (1730977868184499*qd1^2*sin(2*q2))/35184372088832 - (1730977868184499*q3*qd1^2)/17592186044416 - (1730977868184499*q3*qd2^2)/17592186044416 - (2598543999581295917430234203809*qd1^2)/39614081257132168796771975168 - (2598543999581295917430234203809*qd2^2)/39614081257132168796771975168 + (1730977868184499*q3*qd1^2*cos(q2)^2)/17592186044416];                                                                                                                                       


g = 9.81; 
% Par gravitatorio
Ga = [                                                                                                                                                                       0;
      g*((2598543999581295917430234203809*sin(q2))/39614081257132168796771975168 - (18463766272926129*cos(q2))/140737488355328 + (1730977868184499*q3*sin(q2))/17592186044416);
                                                                                                                                 -(1730977868184499*g*cos(q2))/17592186044416];

% Ecuación del robot
%    Tau = M*qpp + V + G
  Tau = [Tau1;Tau2;Tau3];

  
qdd = Ma\(Tau-Va-Ga);
% Aceleraciones
%   qdd = [0;0;0];
  